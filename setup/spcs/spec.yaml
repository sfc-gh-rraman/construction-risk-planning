# VIGIL Risk Planning - SPCS Service Specification
# Deploys both backend and frontend as a single service

spec:
  containers:
    # Backend API container
    - name: vigil-backend
      image: /RISK_PLANNING_DB/SPCS/APP_REPO/vigil-backend:latest
      env:
        SNOWFLAKE_DATABASE: RISK_PLANNING_DB
        SNOWFLAKE_SCHEMA: CONSTRUCTION_RISK
        SNOWFLAKE_WAREHOUSE: RISK_COMPUTE_WH
        PORT: "8000"
        HOST: "0.0.0.0"
      resources:
        requests:
          memory: "1Gi"
          cpu: "0.5"
        limits:
          memory: "2Gi"
          cpu: "1"
      readinessProbe:
        port: 8000
        path: /health
      volumeMounts:
        - name: logs
          mountPath: /app/logs

    # Frontend container
    - name: vigil-frontend
      image: /RISK_PLANNING_DB/SPCS/APP_REPO/vigil-frontend:latest
      resources:
        requests:
          memory: "256Mi"
          cpu: "0.25"
        limits:
          memory: "512Mi"
          cpu: "0.5"
      readinessProbe:
        port: 80
        path: /health

  endpoints:
    # Main endpoint for the frontend
    - name: vigil-ui
      port: 80
      public: true
      protocol: HTTPS
      
    # API endpoint (can also be accessed via frontend proxy)
    - name: vigil-api
      port: 8000
      public: true
      protocol: HTTPS

  volumes:
    - name: logs
      source: local
      size: "1Gi"

  networkPolicyConfig:
    allowInternetEgress: true
